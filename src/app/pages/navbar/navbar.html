<mat-toolbar>
  <mat-toolbar-row>
    <img src="N.png" alt="Logo" class="logo" (click)="onMenuClick()">
    <span class="title" (click)="onMenuClick()">ext Tickets</span>
    <span class="spacer"></span>

    <!-- Section Profil toujours visible -->
    <div class="profile-section" *ngIf="isLoggedIn">
      <button
        mat-icon-button
        class="profile-button"
        [matMenuTriggerFor]="profileMenu"
        (click)="!isLoggedIn && onLoginClick()"
        aria-label="Profil">
        <mat-icon>account_circle</mat-icon>
      </button>

      <!-- Define the menu always so #profileMenu exists -->
      <mat-menu #profileMenu="matMenu" class="profile-menu">
        <div class="profile-info" *ngIf="isLoggedIn">
          <div class="profile-avatar">
            <mat-icon>account_circle</mat-icon>
          </div>
          <div class="profile-details">
            <p class="profile-name">{{ prenom }} {{ nom }}</p>
            <p class="profile-email" *ngIf="userProfile?.email">{{ userProfile.email }}</p>
            <p class="profile-role" *ngIf="isAdmin">{{ role }}</p>
          </div>
        </div>

        <mat-divider *ngIf="isLoggedIn"></mat-divider>
        
        <button mat-menu-item (click)="onProfileClick()" *ngIf="isLoggedIn">
          <mat-icon>person</mat-icon>
          <span>Mon Profil</span>
        </button>

        <button mat-menu-item (click)="onLogoutClick()" *ngIf="isLoggedIn">
          <mat-icon>logout</mat-icon>
          <span>DÃ©connexion</span>
        </button>
      </mat-menu>
    </div>
  </mat-toolbar-row>
</mat-toolbar>